# 模块 4: 设计模式

> 应用常见设计模式

## 单例模式

```javascript
class Config {
  static instance = null;
  
  constructor() {
    if (Config.instance) {
      return Config.instance;
    }
    
    this.settings = {
      apiUrl: 'https://api.example.com',
      theme: 'light',
      language: 'zh-CN'
    };
    
    Config.instance = this;
  }
  
  get(key) {
    return this.settings[key];
  }
  
  set(key, value) {
    this.settings[key] = value;
  }
}

// 使用
const config1 = new Config();
const config2 = new Config();
console.log(config1 === config2);  // true
```

## 观察者模式

```javascript
class EventEmitter {
  constructor() {
    this.events = {};
  }
  
  on(event, callback) {
    if (!this.events[event]) {
      this.events[event] = [];
    }
    this.events[event].push(callback);
    
    return () => this.off(event, callback);
  }
  
  off(event, callback) {
    if (!this.events[event]) return;
    this.events[event] = this.events[event].filter(cb => cb !== callback);
  }
  
  emit(event, data) {
    if (!this.events[event]) return;
    this.events[event].forEach(callback => callback(data));
  }
}

// 使用
const emitter = new EventEmitter();
emitter.on('user:login', (user) => {
  console.log('用户登录:', user.name);
  updateUI(user);
});
emitter.emit('user:login', { name: '张三', id: 123 });
```

## 工厂模式

```javascript
class FormFieldFactory {
  static createField(type, config) {
    switch (type) {
      case 'text':
        return new TextField(config);
      case 'select':
        return new SelectField(config);
      case 'date':
        return new DateField(config);
      default:
        throw new Error(`Unknown field type: ${type}`);
    }
  }
}

// 使用
const nameField = FormFieldFactory.createField('text', {
  name: 'username',
  label: '用户名',
  required: true
});
```

## 关键要点

1. **单例** - 确保只有一个实例
2. **观察者** - 事件驱动编程
3. **工厂** - 创建对象的统一接口
4. **选择合适** - 根据场景选择模式

👉 下一个: [模块 5: 错误处理](./05-错误处理.md)
