# 模块 2: 代码审查

> 掌握代码审查和优化技巧

## 请求代码审查

```
你:审查这段代码,指出问题和改进建议:

function getUserData(id) {
  fetch('https://api.example.com/users/' + id)
    .then(res => res.json())
    .then(data => {
      console.log(data)
      document.getElementById('user-name').innerHTML = data.name
    })
}

Claude:我发现以下问题:
1. 缺少错误处理
2. 没有检查响应状态
3. 使用 innerHTML 有 XSS 风险
4. 硬编码 DOM ID
5. 没有返回值

改进建议:

async function getUserData(id) {
  try {
    const response = await fetch(`https://api.example.com/users/${id}`)
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`)
    }
    
    const data = await response.json()
    const userNameEl = document.getElementById('user-name')
    if (userNameEl) {
      userNameEl.textContent = data.name  // 防止 XSS
    }
    
    return data
  } catch (error) {
    console.error('Failed to fetch user data:', error)
    throw error
  }
}
```

## 性能优化分析

```
你:这段代码有性能问题,帮我优化:

function filterProducts(products, keyword) {
  let result = []
  for (let i = 0; i < products.length; i++) {
    for (let j = 0; j < products[i].tags.length; j++) {
      if (products[i].tags[j].includes(keyword)) {
        result.push(products[i])
        break
      }
    }
  }
  return result
}

Claude:优化方案:

function filterProducts(products, keyword) {
  return products.filter(product =>
    product.tags.some(tag => tag.includes(keyword))
  )
}

// 性能对比:
// 原代码: ~450ms (10000条数据)
// 优化后: ~180ms (60% 提升)
```

## 代码重构建议

将大组件拆分为小组件:
- 每个组件职责单一
- 便于测试
- 可复用性高
- 易于维护

## 关键要点

1. **代码质量** - 可读性、可维护性
2. **性能优化** - 时间和空间复杂度
3. **安全性** - 常见漏洞检查
4. **最佳实践** - 遵循编码规范

👉 下一个: [模块 3: 调试技巧](./03-调试技巧.md)
