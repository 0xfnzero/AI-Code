# 第五课：文件操作进阶

> 🎯 **学习目标**：掌握复杂文件操作、跨文件重构和批量处理技巧

## 1. 复杂文件结构管理

### 创建完整项目结构

```
你：创建一个标准的前端项目结构

Claude 会创建：
my-app/
├── src/
│   ├── components/
│   │   ├── Header.js
│   │   ├── Footer.js
│   │   └── Sidebar.js
│   ├── styles/
│   │   ├── main.css
│   │   ├── variables.css
│   │   └── components/
│   ├── utils/
│   │   ├── helpers.js
│   │   └── api.js
│   └── index.js
├── public/
│   ├── index.html
│   └── assets/
├── tests/
├── .gitignore
├── README.md
└── package.json
```

### 项目模板管理

```
你：保存当前项目结构为模板 "webapp-template"

稍后使用：
你：基于 "webapp-template" 创建新项目
```

## 2. 跨文件搜索和替换

### 全局搜索

```
你：在所有文件中搜索 "API_KEY"

Claude：找到 3 处使用：
- src/utils/api.js:15
- src/config.js:8
- tests/api.test.js:22
```

### 跨文件替换

```
你：把所有文件中的 "oldFunction" 替换为 "newFunction"

Claude：
✅ src/utils/helpers.js - 3 处
✅ src/components/Header.js - 1 处
✅ src/index.js - 2 处
共替换 6 处
```

### 正则表达式搜索

```
你：查找所有以 "fetch" 开头的函数调用

你：找出所有的 console.log 语句

你：搜索所有 TODO 和 FIXME 注释
```

## 3. 代码重构

### 提取组件

```
你：把 index.html 中的导航栏提取为单独的组件

Claude：
1. 创建 components/Navbar.js
2. 提取导航栏代码
3. 更新 index.html 引用
4. 保持功能不变
```

### 提取函数

```
你：把这段重复的代码提取为一个函数

Claude：
已创建 utils/formatDate.js
并更新了所有使用该逻辑的地方：
- src/components/Post.js
- src/components/Comment.js
- src/utils/display.js
```

### 模块化重构

```
你：把 app.js 拆分成多个模块

Claude：
已拆分为：
- modules/auth.js - 认证相关
- modules/ui.js - UI 操作
- modules/data.js - 数据处理
- app.js - 主入口
```

## 4. 文件导入导出管理

### 分析依赖关系

```
你：显示 index.js 依赖了哪些文件

Claude：
index.js 依赖树：
├── utils/helpers.js
├── components/Header.js
│   └── styles/header.css
├── components/Footer.js
└── utils/api.js
    └── config.js
```

### 更新导入路径

```
你：把所有相对路径改为绝对路径（使用 @ 别名）

前：import Header from '../components/Header'
后：import Header from '@/components/Header'
```

### 清理未使用的导入

```
你：找出并删除所有未使用的 import 语句

Claude：
清理了 5 个文件中的冗余导入：
- src/index.js: 删除 2 个
- src/utils/helpers.js: 删除 1 个
...
```

## 5. 批量文件操作

### 批量创建

```
你：创建 5 个页面组件：Home, About, Contact, Services, Blog
每个都要有对应的 JS, CSS 文件

Claude：
创建了：
components/
├── Home/
│   ├── Home.js
│   └── Home.css
├── About/
│   ├── About.js
│   └── About.css
...
```

### 批量重命名

```
你：把所有 .jsx 文件重命名为 .js

Claude：
重命名了 8 个文件：
Header.jsx → Header.js
Footer.jsx → Footer.js
...
```

### 批量添加内容

```
你：给所有 JavaScript 文件顶部添加版权声明

Claude：
已添加到 12 个文件：
/**
 * Copyright (c) 2024 Your Company
 * All rights reserved.
 */
```

## 6. 配置文件管理

### 创建配置文件

```
你：创建项目配置文件 config.js，包含：
- API 地址
- 环境变量
- 应用设置

Claude：
已创建 src/config.js 并设置合理的默认值
```

### 环境配置

```
你：创建开发和生产环境的配置文件

Claude：
创建了：
.env.development
.env.production
config/dev.config.js
config/prod.config.js
```

### 配置文件模板

```
你：生成一个 .env.example 文件

Claude：
创建了 .env.example：
API_URL=https://api.example.com
API_KEY=your_api_key_here
DEBUG=false
```

## 7. 代码质量工具

### ESLint 配置

```
你：配置 ESLint，使用 Airbnb 规范

Claude：
1. 创建 .eslintrc.json
2. 安装必要的包
3. 添加脚本到 package.json
```

### Prettier 配置

```
你：添加 Prettier 代码格式化

Claude：
1. 创建 .prettierrc
2. 创建 .prettierignore
3. 配置推荐设置
```

### 代码检查

```
你：检查项目中的代码质量问题

Claude：
发现 5 个问题：
1. src/utils/api.js:25 - 未使用的变量
2. src/components/Header.js:10 - 缺少 key 属性
...
```

## 8. 文件监控和自动化

### 监听文件变化

```
你：当 style.css 改变时，自动刷新浏览器

Claude：
已设置 live-server 监听CSS文件
```

### 自动化任务

```
你：创建一个脚本，在保存时自动：
1. 格式化代码
2. 运行 lint 检查
3. 运行测试

Claude：
已创建 scripts/pre-commit.sh
并配置了 git hook
```

## 9. 文件备份和版本

### 创建备份

```
你：备份当前项目状态

Claude：
已创建备份：backup-2024-10-08/
```

### 版本标记

```
你：标记当前版本为 v1.0.0

Claude：
✅ 更新 package.json version: "1.0.0"
✅ 创建 git tag v1.0.0
✅ 更新 CHANGELOG.md
```

### 比较版本

```
你：比较当前版本和上一个版本的差异

Claude：
主要变化：
+ 新增 3 个文件
- 删除 1 个文件
~ 修改 8 个文件
```

## 10. 项目文档自动化

### 生成目录结构文档

```
你：生成项目目录结构文档

Claude：
已创建 docs/structure.md，包含完整的目录树
```

### 生成 API 文档

```
你：分析所有函数并生成 API 文档

Claude：
已创建 docs/api.md
包含 25 个函数的详细文档
```

### 更新 README

```
你：更新 README，添加新功能说明

Claude：
已更新 README.md：
- 添加新功能列表
- 更新使用示例
- 更新依赖说明
```

## 11. 实战案例

### 案例 1：项目迁移

**场景**：从 JavaScript 迁移到 TypeScript

```
你：把整个项目转换为 TypeScript

Claude：
执行迁移计划：
1. 重命名所有 .js 为 .ts
2. 添加类型注解
3. 创建 tsconfig.json
4. 更新 package.json
5. 修复类型错误

迁移完成！
- 转换 15 个文件
- 添加 50+ 类型定义
- 0 个类型错误
```

### 案例 2：代码标准化

**场景**：统一项目代码风格

```
你：统一项目代码风格：
- 使用单引号
- 2 空格缩进
- 末尾加分号

Claude：
1. 配置 Prettier
2. 格式化所有文件
3. 更新 .editorconfig

已格式化 20 个文件
```

### 案例 3：性能优化

**场景**：优化静态资源

```
你：优化所有图片和代码文件

Claude：
优化结果：
Images:
- 压缩 12 张图片
- 节省 2.5 MB

Code:
- 压缩 JavaScript
- 压缩 CSS
- 移除注释
- 节省 150 KB
```

## 12. 高级搜索技巧

### 使用通配符

```
你：找出所有 test*.js 文件

你：显示 components/**/*.js 的列表
```

### 组合条件搜索

```
你：找出同时包含 "fetch" 和 "async" 的文件

你：搜索包含 TODO 但不包含 DONE 的注释
```

### 上下文搜索

```
你：找出调用 getUserData 函数的所有位置，显示前后 5 行代码

Claude：
找到 3 处调用：

1. src/components/Profile.js:45
  40: function loadProfile() {
  41:   setLoading(true)
  42:   try {
  43:     const data = await getUserData(userId)
  44:     setProfile(data)
  45:   } catch (error) {
  46:     handleError(error)
  47:   }
  48: }
...
```

## 13. 文件模板系统

### 创建文件模板

```
你：创建一个 React 组件模板

Claude：
创建 templates/ReactComponent.js：
import React from 'react'
import './{{ComponentName}}.css'

function {{ComponentName}}(props) {
  return (
    <div className="{{component-name}}">
      {/* Component content */}
    </div>
  )
}

export default {{ComponentName}}
```

### 使用模板生成文件

```
你：使用 React 组件模板创建 UserCard 组件

Claude：
基于模板创建：
- components/UserCard.js
- components/UserCard.css
- components/UserCard.test.js
```

## 14. 工作区管理

### 多项目切换

```
你：切换到项目 "website"

Claude：
已切换到 ~/projects/website
当前目录：website/
```

### 工作区快照

```
你：保存当前工作状态

Claude：
已保存快照：
- 打开的文件列表
- 当前分支
- 暂存的修改
```

## 15. 实践练习

### 练习 1：项目重构

任务：
1. 创建一个混乱的单文件项目
2. 将其重构为模块化结构
3. 提取重复代码
4. 添加文档

### 练习 2：批量操作

任务：
1. 创建 10 个相似的文件
2. 批量修改某个属性
3. 批量重命名
4. 批量添加注释

### 练习 3：配置管理

任务：
1. 设置开发环境配置
2. 设置生产环境配置
3. 创建配置切换脚本
4. 测试不同环境

### 练习 4：文档生成

任务：
1. 为现有项目生成完整文档
2. 包括目录结构、API、使用指南
3. 添加代码示例
4. 生成部署说明

## 16. 常见问题解决

### 问题 1：文件冲突

```
你：合并时出现冲突，能帮我解决吗？

Claude：
分析冲突：
- index.js 第 25 行
- 两个版本都修改了同一函数

建议：
保留版本 A 的性能优化
同时合并版本 B 的错误处理
```

### 问题 2：依赖混乱

```
你：项目导入关系很混乱，能理清吗？

Claude：
我会：
1. 分析所有导入
2. 检测循环依赖
3. 生成依赖图
4. 提供优化建议
```

### 问题 3：文件丢失

```
你：我不小心删除了一个重要文件，能恢复吗？

Claude：
检查 git 历史...
找到了：src/utils/helpers.js 在 commit abc123
要恢复吗？
```

## 17. 最佳实践

### 文件组织原则

1. **按功能分组**，不是按类型
   ```
   ✅ features/user/UserProfile.js
   ❌ components/UserProfile.js
   ```

2. **保持扁平结构**，避免过深嵌套
   ```
   ✅ src/components/Header.js
   ❌ src/app/views/components/ui/Header.js
   ```

3. **命名一致性**
   ```
   ✅ UserProfile.js, UserProfile.css, UserProfile.test.js
   ❌ UserProfile.js, user-profile.css, testUserProfile.js
   ```

### 代码重构策略

1. **小步前进** - 每次只重构一个方面
2. **保持测试** - 重构前后运行测试
3. **提交频繁** - 每个小改动都提交
4. **文档同步** - 代码和文档一起更新

### 自动化建议

自动化这些重复任务：
- 代码格式化
- Lint 检查
- 测试运行
- 文档生成
- 部署流程

## 18. 下一步

🎉 恭喜你掌握了文件操作进阶技巧！

现在你已经学会了：
- ✅ 复杂项目结构管理
- ✅ 跨文件重构
- ✅ 批量操作
- ✅ 自动化工具配置

**准备学习更高级的内容了吗？**

👉 下一课：[项目实战：完整Web应用](./06-项目实战-Web应用.md)

在那里，我们会：
1. 从零开始构建完整项目
2. 实现前后端交互
3. 添加数据库集成
4. 部署到线上

---

💡 **小贴士**：
- 建立自己的项目模板库
- 定期重构代码，保持整洁
- 使用版本控制追踪每次改动
- 为常用操作创建脚本
